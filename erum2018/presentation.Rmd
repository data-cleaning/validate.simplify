---
title: "Validatetools"
subtitle: "Validatetools: Check and resolve contradictory rule sets" 
author: "Edwin de Jonge"
date: "Statistics Netherlands / eRum 2018"
output:
  beamer_presentation:
    includes:
      in_header: header.tex
    keep_tex: yes
    theme: "Frankfurt"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval = FALSE)
library(validatetools)
```

## {.plain .fragile}

\begin{centering}
  \includegraphics[width=0.9\paperwidth]{img/bad-data}
  \par
\end{centering}

## Data cleaning...

A large part of your job is spent in data-cleaning:

- getting your data in the right shape (e.g. `tidyverse`)

- assessing missing data (e.g. `VIM`)

- checking validity (e.g. `validate`)

- locating and removing errors: `errorlocate`!

- impute values for missing or erroneous data (e.g. `simputation`)

## {.plain}

\begin{center}
  \includegraphics[height=1\paperheight]{img/keep-calm-and-validate}
\end{center}

## Completeness

-


## Validation rules?

Package `validate` allows to:

- formulate explicit data rule that data must conform to:

```{r}
library(validate)
check_that( data.frame(age=160, driver_license=TRUE), 
  age >= 0, 
  age < 150,
  if (driver_license == TRUE) age >= 16
)
```

## {.plain}

\hspace{-1.5cm}
\includegraphics[width=1\paperwidth]{img/rules.png}

## Rules

A lot of datacleaning packages are based on explicit rules that data must conform to.

- `validate` to check **validity** of data
- `errorlocate` to find **errors**.
- `rspa`, `deductive`, `dcmodify` for **correction** and **imputation** using data rules.

## Rules (2)

- Data rules are solidified domain knowledge.
- Real world knowledge e.g. :

      - `age` is not negative.
      - human `age` is less then `150` years.
      
- Expert knowledge, e.g:

      - if `profit > 0` then `turnover > 0`
      - if `married` then 'age > 16' 


## Data checking

- A large part of data quality assurance in Official Statistics is checking
data validity:
- $n$, number of records is high, typically > 0.5M
- $p$, number of columns is high, typically > 20
- population is diverse, different rules for different subpopulations.
- often many processing steps from input to statistic each checking/using (implicit) domain knowledge.

### Result: 

- Often many rules, great and small
- Rules often defined multiple times at different processing steps.
- Rules may partially contradict each other.


## Validate tools

- Use `validate` to collect 

## Formally...

### Rule set $S$

$$
S = r_1 \land \cdots \land r_n
$$

### Rule $r_i$

$$
r_i = \bigvee_j C_i^j
$$

### Atomic clause $C_i^j$

$$
C_i^j(\la{x}) = \left\{
  \begin{array}{l}
 \la{a}^T\la{x} \leq b \\
  \la{a}^T\la{x} = b \\
  x_j \in F_{ij}  \textrm{with } F_{ij} \subseteq D_j \\
  x_j \not\in F_{ij} \textrm{with } F_{ij} \subseteq D_j \\
  \end{array}
\right.
$$