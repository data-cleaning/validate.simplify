---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
library(validatetools)
```

[![CRAN_Status_Badge](http://www.r-pkg.org/badges/version/validatetools)](https://cran.r-project.org/package=validatetools)[![Travis-CI Build Status](https://travis-ci.org/data-cleaning/validatetools.svg?branch=master)](https://travis-ci.org/data-cleaning/validatetools)
[![Coverage Status](https://img.shields.io/codecov/c/github/data-cleaning/validatetools/master.svg)](https://codecov.io/github/data-cleaning/validatetools?branch=master)

# validatetools

`validatetools` is a utility package for managing validation rule sets that can be defined with `validate`.
In production systems validation rule sets tend to grow organically and accumulate redundant or (partial)
contradictory rules. `validatetools` helps to identify problems with large rule sets and includes simplification
methods for resolving issues.

## Installation

You can install validatetools from github with:

``` r
# install.packages("devtools")
devtools::install_github("data-cleaning/validatetools")
```

## Example

### Check for feasibility

```{r}
rules <- validator( x > 0)
is_infeasible(rules)

rules <- validator( x > 0
                  , x < 0
                  )
is_infeasible(rules)
```


### Value substitution

```{r}
rules <- validator( rule1 = z > 1
                  , rule2 = y > z
                  , rule3 = if (gender == "male") w > 2
                  , rule4 = gender %in% c("male", "female")
                  )
substitute_values(rules, z = 3, gender = "male")
```

### Finding fixed values

```{r}
rules <- validator( x >= 0, x <=0)
detect_fixed_values(rules)
simplify_fixed_values(rules)

rules <- validator( rule1 = x1 + x2 + x3 == 0
                  , rule2 = x1 + x2 >= 0
                  , rule3 = x3 >=0
                  )
simplify_fixed_values(rules)
```

### Simplifying conditional statements

```{r}
# non-relaxing clause
rules <- validator( r1 = if (x > 1) y > 3
                  , r2 = y < 2
                  )
# y > 3 is always FALSE so r1 can be simplified
simplify_conditional(rules)


# non-constraining clause
rules <- validator( r1 = if (x > 0) y > 0
                  , r2 = if (x < 1) y > 1
                  )
simplify_conditional(rules)
```

### Removing redundant rules

```{r}
rules <- validator( rule1 = x > 1
                  , rule2 = x > 2
                  )

# rule1 is superfluous
simplify_redundancy(rules)

rules <- validator( rule1 = x > 2
                  , rule2 = x > 2
)

# standout: rule1 and rule2, oldest rules wins
simplify_redundancy(rules)

# Note that detection signifies both rules!
detect_redundancy(rules)
```
